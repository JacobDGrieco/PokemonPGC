(() => {
	const gen = 9.5;
	const GAME_KEYS = ["legendszamd"];

	const baseSpriteIcon = (gameKey, natiId) => _iconSprite(gen, gameKey, natiId);
	const task = (gameKey, name) => _task(gameKey, name);
	const megaStone = (name) => _megaStone(gen, name);
	const tm = (type) => _tm(gen, type);

	const SECTIONS = [
		{ id: "catching", title: "Gotta Catch 'Em All" },
		{ id: "story", title: "Main Story" },
		{ id: "side-quests", title: "Side Quests" },
		{ id: "mabels-research", title: "Mabel's Research" },
		{ id: "mega-stones", title: "Mega Stones" },
		{ id: "fashion", title: "Fashion" },
		{ id: "thms", title: "TMs" },
	];

	const TASKS_BY_SECTION = {
		"catching": [
			{
				id: 1, text: "Catch all the Mythicals", children: [
					{ id: 1, text: "Catch Heatran", img: ({ gameKey }) => baseSpriteIcon(gameKey, 485), },
					{ id: 2, text: "Catch Darkrai", img: ({ gameKey }) => baseSpriteIcon(gameKey, 491), },
					{ id: 3, text: "Catch Kyogre", img: ({ gameKey }) => baseSpriteIcon(gameKey, 382), },
					{ id: 4, text: "Catch Groudon", img: ({ gameKey }) => baseSpriteIcon(gameKey, 383), },
					{ id: 5, text: "Catch Rayquaza", img: ({ gameKey }) => baseSpriteIcon(gameKey, 384), },
					{ id: 6, text: "Catch Latias", img: ({ gameKey }) => baseSpriteIcon(gameKey, 380), },
					{ id: 7, text: "Catch Latios", img: ({ gameKey }) => baseSpriteIcon(gameKey, 381), },
					{ id: 8, text: "Catch Cobalion", img: ({ gameKey }) => baseSpriteIcon(gameKey, 638), },
					{ id: 9, text: "Catch Terrakion", img: ({ gameKey }) => baseSpriteIcon(gameKey, 639), },
					{ id: 10, text: "Catch Virizion", img: ({ gameKey }) => baseSpriteIcon(gameKey, 640), },
				],
			},
			{
				id: 2, text: "Catch all the Mythicals", children: [
					{ id: 1, text: "Catch Keldeo", img: ({ gameKey }) => baseSpriteIcon(gameKey, 647), },
					{ id: 2, text: "Catch Meloetta", img: ({ gameKey }) => baseSpriteIcon(gameKey, 648), },
					{ id: 3, text: "Catch Genesect", img: ({ gameKey }) => baseSpriteIcon(gameKey, 649), },
					{ id: 4, text: "Catch Hoopa", img: ({ gameKey }) => baseSpriteIcon(gameKey, 720), },
					{ id: 5, text: "Catch Volanion", img: ({ gameKey }) => baseSpriteIcon(gameKey, 721), },
					{ id: 6, text: "Obtain Megearna", img: ({ gameKey }) => baseSpriteIcon(gameKey, 801), },
					{ id: 7, text: "Catch Marshadow", img: ({ gameKey }) => baseSpriteIcon(gameKey, 802), },
					{ id: 8, text: "Catch Zeraora", img: ({ gameKey }) => baseSpriteIcon(gameKey, 807), },
					{ id: 9, text: "Catch Meltan", img: ({ gameKey }) => baseSpriteIcon(gameKey, 808), },
					{ id: 10, text: "Obtain Melmetal", img: ({ gameKey }) => baseSpriteIcon(gameKey, 809), },
				],
			},
			{
				id: 3, text: "Complete all In-Game trades", children: [
					{ id: 1, text: "Porygon for Porygon", img: ({ gameKey }) => task(gameKey, "porygon-for-porygon"), tooltip: "The traded Porygon will come with an Upgrade being held" },
				],
			},
		],
		"story": [
			{
				id: 1, text: "Complete the first 11 Hyperspace Missions", children: [
					{ id: 1, text: "1 - Hyperspace Lumiose Survey No. 1", },
					{ id: 2, text: "2 - Lebanne Arrives with a Bang!", },
					{ id: 3, text: "3 - Hyperspace Lumiose Survey No. 2", },
					{ id: 4, text: "4 - Le Musée et le Café", },
					{ id: 5, text: "5 - A Boom from the Strategy Room", },
					{ id: 6, text: "6 - Hyperspace Lumiose Survey No. 3", },
					{ id: 7, text: "7 - Naveen's Not OK", },
					{ id: 8, text: "8 - Hyperspace Lumiose Survey No. 4", },
					{ id: 9, text: "9 - Hyperspace Lumiose Survey No. 5", },
					{ id: 10, text: "10 - Mayhem at Midnight", },
					{ id: 11, text: "11 - Hyperspace Lumiose Survey No. 6", },
				],
			},
			{
				id: 2, text: "Complete the Epilogue Hyperspace Missions", children: [
					{ id: 1, text: "12 - The Greatest Gift", },
					{ id: 2, text: "13 - A Ruby-Red Legend", },
					{ id: 3, text: "14 - A Sapphire-Blue Legend", },
				],
			},
		],
		"side-quests": [
			{
				id: 1, text: "Complete all EX Quests", children: [
					{ id: 1, text: "EX Quest EX1 - Shine Bright Like a Gemstone" },
					{ id: 2, text: "EX Quest EX2 - Project M" },
					{ id: 3, text: "EX Quest EX3 - Raging Lightning" },
				],
			},
			{
				id: 2, text: "Complete all Side Quests", children: [
					{ id: 1, text: "120 - Donuts of Unworldly Deliciousness!", },
					{ id: 2, text: "121 - A Big Ol' Battle", },
					{ id: 3, text: "122 - Let's Golden Gooooooo!", },
					{ id: 4, text: "123 - Chaging Toward Victory", },
					{ id: 5, text: "124 - Multistrike, Multistrike, Multistrike Moves!", },
					{ id: 6, text: "125 - My Hasty Jolteon", },
					{ id: 7, text: "126 - Cyclizoom", },
					{ id: 8, text: "127 - Mime Jr.'s First Big Job", },
					{ id: 9, text: "128 - A Novel Adventure", },
					{ id: 10, text: "129 -  A Work of Great Love", },
					{ id: 11, text: "130 - A Tale of Mystery", },
					{ id: 12, text: "131 - Rouge District's Utility Hole Covers?", },
					{ id: 13, text: "132 - Bitter Blue Flames vs. Blazing Crimson", },
					{ id: 14, text: "133 - Farfetch'd Ambush", },
					{ id: 15, text: "134 - Squawking, Squabbling Squawkabilly!", },
					{ id: 16, text: "135 - Cubone's Survey", },
					{ id: 17, text: "136 - Fidough Loves Walks!", },
					{ id: 18, text: "137 - Fungi-ble Goods", },
					{ id: 19, text: "138 - Octolock Away the Pain!", },
					{ id: 20, text: "139 - The Dauntless Raichu Duo", },
					{ id: 21, text: "140 - A Message from Across Dimensions", },
					{ id: 22, text: "141 - Rouge Mega Showdown", },
					{ id: 23, text: "142 - That's Some Nacli Coffee", },
					{ id: 24, text: "143 - Which Meowth Do You Purrfer", },
					{ id: 25, text: "144 - Imitation Is the Sincerest Form of Flattery", },
					{ id: 26, text: "145 - My Neightbor Tinkatuff", },
					{ id: 27, text: "146 - Terror in the Sands", },
					{ id: 28, text: "147 - Our Gluttonous Gulpin", },
					{ id: 29, text: "148 - A Sorta Scary Cemetary Story", },
					{ id: 30, text: "149 - Scovillain's Spice-Off", },
					{ id: 31, text: "150 - Corvisquire's Search", },
					{ id: 32, text: "151 - Hyperspatial Scuffle vs DYNA4MO!" },
					{ id: 33, text: "152 - Hyperspatial Scuffle vs. the Fist of Justice!", },
					{ id: 34, text: "153 - Hyperspatial Scuffle vs. the Rust Syndicate!", },
					{ id: 35, text: "154 - Hyperspatial Scuffle vs. the SBC!", },
					{ id: 36, text: "155 - Hyperspatial Scuffle vs. Team Flare Nouveau!", },
					{ id: 37, text: "156 - A Special Seviper", },
					{ id: 38, text: "157 - What;s Wafting from Wigglytuff?", },
					{ id: 39, text: "158 - The Trainer Tipster", },
					{ id: 40, text: "159 - Who Nicked That Snack?", },
					{ id: 41, text: "160 - Feebas's New Friends", },
					{ id: 42, text: "161 - Frigibax's Friend-Finding", },
					{ id: 43, text: "162 - Maybe Morpeko Guards?", },
					{ id: 44, text: "163 - Help Us Pick a Name!", },
					{ id: 45, text: "164 - Kiosk Conundrum", },
					{ id: 46, text: "165 - The Lumiose Museum Heist", },
					{ id: 47, text: "166 - The Joy of Mimicry", },
					{ id: 48, text: "167 - Porygon's Polygon Count", },
					{ id: 49, text: "168 - Rêve de Musharna", },
					{ id: 50, text: "169 - A Gallant Indeedee", },
					{ id: 51, text: "170 - Rotom Showcase", },
					{ id: 52, text: "171 - Awaken, Cofagrigus!", },
					{ id: 53, text: "172 - Sawk vs. Throh", },
					{ id: 54, text: "173 - Be a Defenseless Dodger!", },
					{ id: 55, text: "174 - I Still Remember the Taste", },
					{ id: 56, text: "175 - Romance avec Purrloin", },
					{ id: 57, text: "176 - Ultimate Beans of Supreme Ultimacy", },
					{ id: 58, text: "177 - Triste Dreams of Tatsugiri", },
					{ id: 59, text: "178 - Dondozo Down in the Dumps", },
					{ id: 60, text: "179 - A Sub-30-Second Loss", },
					{ id: 61, text: "180 - A Wild Rosebud", },
					{ id: 62, text: "181 - Hyperspatial Slugfest vs. DYNA4MO", },
					{ id: 63, text: "182 - Hyperspatial Slugfest vs. the Fist of Justice", },
					{ id: 64, text: "183 - Hyperspatial Slugfest vs. the Rust Syndicate", },
					{ id: 65, text: "184 - Hyperspatial Slugfest vs. the SBC", },
					{ id: 66, text: "185 - Hyperspatial Slugfest vs. Team Flare Nouveau", },
					{ id: 67, text: "186 - The Ultimate Techniques", },
					{ id: 68, text: "187 - The Dauntless Dragalge Trainer", },
					{ id: 69, text: "188 - Start Special Scanning", },
					{ id: 70, text: "189 - Siblings of the Sky", },
					{ id: 71, text: "190 - A Mimikyu for My Cutie", },
					{ id: 72, text: "191 - Collecting Four Drives", },
					{ id: 73, text: "192 - The Stealthy Shadow", },
					{ id: 74, text: "193 - Dreams of Meltan", },
					{ id: 75, text: "194 - Volcanion Unleashed", },
					{ id: 76, text: "195 - Restarting Magearna", },
					{ id: 77, text: "196 - The Djinn Unbound", },
					{ id: 78, text: "197 - Ultra-Hardcore Lucario Showdown", },
					{ id: 79, text: "198 - Lida's Lament", },
					{ id: 80, text: "199 - Naveen's Newfound Determination", },
					{ id: 81, text: "200 - Here in Lumiose City", },
				],
			},
		],
		"mabels-research": [
			{ id: 1, text: "Filling Your Mega Evolution Dex", type: "tiered", tiers: [range(70, 90, 5)], tooltip: "Collect Mega Stones", },
			{ id: 2, text: "Filling Your Hyperspace Pokedex", type: "tiered", tiers: [range(5, 130, 5)], tooltip: "Catch unique Pokémon for your Hyperspace Pokedex", },
			{ id: 3, text: "Investigating Hyperspace", type: "tiered", tiers: [range(10, 100, 10), range(150, 450, 50)], tooltip: "Enter Hyperspace pockets", },
		],
		"mega-stones": [
			{ id: 1, text: "Meowsticite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0678-m"), megaStone("meowsticite")], tooltip: "Complete Hyperspace Mission 8", },
			{ id: 2, text: "Raichunite X", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0026-mx"), megaStone("raichunite-x")], tooltip: "Complete Side Quest 139", },
			{ id: 3, text: "Raichunite Y", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0026-my"), megaStone("raichunite-y")], tooltip: "Complete Side Quest 139", },
			{ id: 4, text: "Garchompite Z", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0445-mz"), megaStone("garchompite-z")], },
			{ id: 5, text: "Absolite Z", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0359-mz"), megaStone("absolite-z")], tooltip: "Complete Hyperspace Mission 1", },
			{ id: 6, text: "Lucarionite Z", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0448-mz"), megaStone("lucarionite-z")], tooltip: "Complete Side Quest 197", },
			{ id: 7, text: "Mewtwonite X", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0150-mx"), megaStone("mewtwonite-x")], tooltip: "Complete EX Quest 2", },
			{ id: 8, text: "Mewtownite Y", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0150-my"), megaStone("mewtwonite-y")], tooltip: "Complete EX Quest 2", },
			{ id: 9, text: "Diancite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0719-m"), megaStone("diancite")], tooltip: "Complete EX Quest 1", },

			{ id: 10, text: "Scovillainite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0952-m"), megaStone("scovillainite")], },
			{ id: 11, text: "Glimmoranite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0970-m"), megaStone("glimmoranite")], tooltip: "Find in a Mega Hyperspace Portal", },
			{ id: 12, text: "Tatsugirinite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0978-m"), baseSpriteIcon(gameKey, "0978-d-m"), baseSpriteIcon(gameKey, "0978-s-m"), megaStone("tatsugirinite")], tooltip: "Complete Hyperspace Mission 6", },
			{ id: 13, text: "Chimechite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0358-m"), megaStone("chimechite")], tooltip: "Find in a Mega Hyperspace Portal", },
			{ id: 14, text: "Golisopite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0768-m"), megaStone("golisopite")], tooltip: "Find in a Mega Hyperspace Portal", },
			{ id: 15, text: "Golurkite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0623-m"), megaStone("golurkite")], tooltip: "Find in a Mega Hyperspace Portal", },
			{ id: 16, text: "Staraptite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0398-m"), megaStone("staraptite")], tooltip: "Complete Hyperspace Mission 3", },
			{ id: 17, text: "Crabominite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0740-m"), megaStone("crabominite")], tooltip: "Complete Side Quest 141", },
			{ id: 18, text: "Heatranite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0485-m"), megaStone("heatranite")], tooltip: "Complete Hyperspace Mission 9", },
			{ id: 19, text: "Darkranite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0491-m"), megaStone("darkranite")], tooltip: "Complete Hyperspace Mission 11", },
			{ id: 20, text: "Latiasite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0380-m"), megaStone("latiasite")], tooltip: "Complete Side Quest 189", },
			{ id: 21, text: "Latiosite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0381-m"), megaStone("latiosite")], tooltip: "Complete Side Quest 189", },
			{ id: 22, text: "Blue Orb", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0382-m"), megaStone("blueorb")], tooltip: "Complete Hyperspace Mission 14", },
			{ id: 23, text: "Red Orb", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0383-m"), megaStone("redorb")], tooltip: "Complete Hyperspace Mission 13", },
			{ id: 24, text: "Magearnite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0801-m"), megaStone("magearnite"), baseSpriteIcon(gameKey, "0801-o-m")], tooltip: "Complete Side Quest 195", },
			{ id: 25, text: "Zeraorite", img: ({ gameKey }) => [baseSpriteIcon(gameKey, "0807-m"), megaStone("zeraorite")], tooltip: "Complete EX Quest 3", },
		],
		"thms": [
			{ id: 1, text: "TM 108: Comet Punch", img: () => tm("normal"), },
			{ id: 2, text: "TM 109: Facade", img: () => tm("normal"), },
			{ id: 3, text: "TM 110: Chilling Water", img: () => tm("water"), },
			{ id: 4, text: "TM 111: Sing", img: () => tm("normal"), },
			{ id: 5, text: "TM 112: Acid Spray", img: () => tm("poison"), },
			{ id: 6, text: "TM 113: Low Sweep", img: () => tm("fighting"), },
			{ id: 7, text: "TM 114: Flame Charge", img: () => tm("fire"), },
			{ id: 8, text: "TM 115: Trailblaze", img: () => tm("grass"), },
			{ id: 9, text: "TM 116: Pay Day", img: () => tm("normal"), },
			{ id: 10, text: "TM 117: Silver Wind", img: () => tm("bug"), },
			{ id: 11, text: "TM 118: Shadow Punch", img: () => tm("ghost"), },
			{ id: 12, text: "TM 119: Ominous Wind", img: () => tm("ghost"), },
			{ id: 13, text: "TM 120: Ancient Power", img: () => tm("rock"), },
			{ id: 14, text: "TM 121: Torment", img: () => tm("dark"), },
			{ id: 15, text: "TM 122: False Swipe", img: () => tm("normal"), },
			{ id: 16, text: "TM 123: Poison Fang", img: () => tm("poison"), },
			{ id: 17, text: "TM 124: Psychic Fangs", img: () => tm("psychic"), },
			{ id: 18, text: "TM 125: Mimic", img: () => tm("normal"), },
			{ id: 19, text: "TM 126: Magnet Bomb", img: () => tm("steel"), },
			{ id: 20, text: "TM 127: Dream Eater", img: () => tm("psychic"), },
			{ id: 21, text: "TM 128: Seed Bomb", img: () => tm("grass"), },
			{ id: 22, text: "TM 129: Circle Throw", img: () => tm("fighting"), },
			{ id: 23, text: "TM 130: Charge Beam", img: () => tm("electric"), },
			{ id: 24, text: "TM 131: Drain Punch", img: () => tm("fighting"), },
			{ id: 25, text: "TM 132: Double Hit", img: () => tm("normal"), },
			{ id: 26, text: "TM 133: Blaze Kick", img: () => tm("fire"), },
			{ id: 27, text: "TM 134: Dual Wingbeat", img: () => tm("flying"), },
			{ id: 28, text: "TM 135: Dual Chop", img: () => tm("dragon"), },
			{ id: 29, text: "TM 136: Scorching Sands", img: () => tm("ground"), },
			{ id: 30, text: "TM 137: Storm Throw", img: () => tm("fighting"), },
			{ id: 31, text: "TM 138: Frost Breath", img: () => tm("ice"), },
			{ id: 32, text: "TM 139: Swagger", img: () => tm("normal"), },
			{ id: 33, text: "TM 140: Muddy Water", img: () => tm("water"), },
			{ id: 34, text: "TM 141: Fake Out", img: () => tm("normal"), },
			{ id: 35, text: "TM 142: First Impression", img: () => tm("bug"), },
			{ id: 36, text: "TM 143: Scale Shot", img: () => tm("dragon"), },
			{ id: 37, text: "TM 144: Triple Axel", img: () => tm("ice"), },
			{ id: 38, text: "TM 145: Razor Wind", img: () => tm("normal"), },
			{ id: 39, text: "TM 146: Skull Bash", img: () => tm("normal"), },
			{ id: 40, text: "TM 147: Tri Attack", img: () => tm("normal"), },
			{ id: 41, text: "TM 148: Scald", img: () => tm("water"), },
			{ id: 42, text: "TM 149: Icicle Spear", img: () => tm("ice"), },
			{ id: 43, text: "TM 150: Vacuum Wave", img: () => tm("fighting"), },
			{ id: 44, text: "TM 151: Petal Dance", img: () => tm("grass"), },
			{ id: 45, text: "TM 152: Solar Blade", img: () => tm("grass"), },
			{ id: 46, text: "TM 153: Sky Attack", img: () => tm("flying"), },
			{ id: 47, text: "TM 154: Fissure", img: () => tm("ground"), },
			{ id: 48, text: "TM 155: Sheer Cold", img: () => tm("ice"), },
			{ id: 49, text: "TM 156: Meteor Beam", img: () => tm("rock"), },
			{ id: 50, text: "TM 157: Steel Beam", img: () => tm("steel"), },
			{ id: 51, text: "TM 158: Blast Burn", img: () => tm("fire"), },
			{ id: 52, text: "TM 159: Hydro Cannon", img: () => tm("water"), },
			{ id: 53, text: "TM 160:  Frenzy Plant", img: () => tm("grass"), },
		],
	};

	window.DATA = window.DATA || {};
	window.DATA.sections = window.DATA.sections || {};
	window.DATA.tasks = window.DATA.tasks || {};

	function buildSeedsFor(gameKey) {
		const prefixSectionId = (sid) => `${gameKey}:${sid}`;

		const taskIdRoot = (sectionSuffix, parentId) =>
			`${gameKey}:${sectionSuffix}:${pad3(parentId)}`;

		const taskIdChild = (sectionSuffix, parentId, childId) =>
			`${taskIdRoot(sectionSuffix, parentId)}:${pad3(childId)}`;

		function bindGameKeyFn(fn) {
			if (typeof fn !== "function") return fn;
			return (ctx) => fn({ ...(ctx || {}), gameKey });
		}

		function maptask(gameKey, sectionSuffix, t, parentId = null) {
			const out = { ...t };

			if (out.img) out.img = bindGameKeyFn(out.img);
			if (out.imgS) out.imgS = bindGameKeyFn(out.imgS);

			if (parentId === null) {
				const parent = Number(out.id);
				out.id = taskIdRoot(sectionSuffix, parent);
				parentId = parent;
			} else {
				const child = Number(out.id);
				out.id = taskIdChild(sectionSuffix, parentId, child);
			}

			if (Array.isArray(out.children)) {
				out.children = out.children.map((c) => maptask(gameKey, sectionSuffix, c, parentId));
			}

			return out;
		}

		const sections = SECTIONS.map((s) => ({
			id: prefixSectionId(s.id),
			title: s.title,
		}));

		const tasksBySection = Object.fromEntries(
			Object.entries(TASKS_BY_SECTION).map(([sectionSuffix, arr]) => [
				`${gameKey}:${sectionSuffix}`,
				(arr || []).map((t) => maptask(gameKey, sectionSuffix, t)),
			])
		);

		return { sections, tasksBySection };
	}


	for (const gk of GAME_KEYS) {
		const { sections, tasksBySection } = buildSeedsFor(gk);

		window.DATA.sections[gk] = sections;
		for (const [sectionId, arr] of Object.entries(tasksBySection)) {
			window.DATA.tasks[sectionId] = arr;
		}
	}

	try {
		window.PPGC = window.PPGC || {};
		window.PPGC._seedTaskRegistry = null;
	} catch { }
})();
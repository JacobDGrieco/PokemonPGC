(() => {
	const GAME_KEYS = ["sword", "shield"];

	const P = (parentId) => [parentId];          			// parent-only task
	const C = (parentId, childId) => [parentId, childId]; 	// parent + child task

	const DESKTOP_LAYOUT = {
		"catching": [
			[P(1)],
			[C(1, 1), C(1, 2), C(1, 3)],
		],
		"trainer-cards": [
			[P(1)],
			[C(1, 1), C(1, 2), C(1, 3), C(1, 4), C(1, 5)],
			[C(1, 6), C(1, 7), C(1, 8), C(1, 9), C(1, 10)],
			[C(1, 11), C(1, 12), C(1, 13), C(1, 14), C(1, 15)],
			[C(1, 16), C(1, 17), C(1, 18), C(1, 19), C(1, 20)],
			[C(1, 21), C(1, 22), C(1, 23), C(1, 24), C(1, 25)],
			[C(1, 26), C(1, 27), C(1, 28), C(1, 29), C(1, 30)],
			[C(1, 31), C(1, 32), C(1, 33), C(1, 34), C(1, 35)],
			[C(1, 36), C(1, 37), C(1, 38), C(1, 39), C(1, 40)],
			[C(1, 41), C(1, 42), C(1, 43), C(1, 44), C(1, 45)],
			[C(1, 46), C(1, 47), C(1, 48), C(1, 49), C(1, 50)],
			[C(1, 51), C(1, 52), C(1, 53)],
			[P(2)],
			[C(2, 1), C(2, 2), C(2, 3), C(2, 4), C(2, 5)],
			[C(2, 6), C(2, 7), C(2, 8), C(2, 9), C(2, 10)],
			[C(2, 11), C(2, 12), C(2, 13), C(2, 14), C(2, 15)],
			[C(2, 16), C(2, 17), C(2, 18), C(2, 19), C(2, 20)],
			[P(3)],
			[C(3, 1), C(3, 2), C(3, 3), C(3, 4), C(3, 5)],
			[C(3, 6), C(3, 7), C(3, 8), C(3, 9), C(3, 10)],
			[C(3, 11), C(3, 12), C(3, 13), C(3, 14), C(3, 15)],
			[C(3, 16), C(3, 17), C(3, 18)],
			[P(4)],
			[C(4, 1), C(4, 2), C(4, 3), C(4, 4)],
			[C(4, 5), C(4, 6), C(4, 7), C(4, 8)],
		],
		"thms": [
			[P(1), P(2), P(3), P(4), P(5)],
			[P(6), P(7), P(8), P(9), P(10)],
			[P(11), P(12), P(13), P(14), P(15)],
			[P(16), P(17), P(18), P(19), P(20)],
			[P(21), P(22), P(23), P(24), P(25)],
			[P(26), P(27), P(28), P(29), P(30)],
			[P(31), P(32), P(33), P(34), P(35)],
			[P(36), P(37), P(38), P(39), P(40)],
			[P(41), P(42), P(43), P(44), P(45)],
			[P(46), P(47), P(48), P(49), P(50)],
			[P(51), P(52), P(53), P(54), P(55)],
			[P(56), P(57), P(58), P(59), P(60)],
		],
		"trs": [
			[P(1), P(2), P(3), P(4), P(5)],
			[P(6), P(7), P(8), P(9), P(10)],
			[P(11), P(12), P(13), P(14), P(15)],
			[P(16), P(17), P(18), P(19), P(20)],
			[P(21), P(22), P(23), P(24), P(25)],
			[P(26), P(27), P(28), P(29), P(30)],
			[P(31), P(32), P(33), P(34), P(35)],
			[P(36), P(37), P(38), P(39), P(40)],
			[P(41), P(42), P(43), P(44), P(45)],
			[P(46), P(47), P(48), P(49), P(50)],
			[P(51), P(52), P(53), P(54), P(55)],
			[P(56), P(57), P(58), P(59), P(60)],
			[P(61), P(62), P(63), P(64), P(65)],
			[P(66), P(67), P(68), P(69), P(70)],
			[P(71), P(72), P(73), P(74), P(75)],
			[P(76), P(77), P(78), P(79), P(80)],
			[P(81), P(82), P(83), P(84), P(85)],
			[P(86), P(87), P(88), P(89), P(90)],
			[P(91), P(92), P(93), P(94), P(95)],
			[P(96), P(97), P(98), P(99), P(100)],
		],
		"extra-credit": [
			[P(1)],
			[C(1, 1), C(1, 2), C(1, 3)],
			[P(2)],
			[C(2, 1), C(2, 2), C(2, 3)],
		]
	};

	const COMPACT_LAYOUT = DESKTOP_LAYOUT;

	function buildTaskRowsForGame(gameKey, sharedLayout) {
		const out = {};

		for (const [sectionSuffix, rows] of Object.entries(sharedLayout)) {
			const sectionKey = `${gameKey}:${sectionSuffix}`;

			out[sectionKey] = (rows || []).map((row) =>
				(row || []).map((ref) => {
					if (typeof ref === "string") return ref;

					const parentId = ref?.[0];
					const childId = ref?.[1];

					if (parentId == null) return null;

					return childId == null
						? `${sectionKey}:${pad3(parentId)}`
						: `${sectionKey}:${pad3(parentId)}:${pad3(childId)}`;
				}).filter(Boolean)
			);
		}

		return out;
	}

	for (const gameKey of GAME_KEYS) {
		const desktopLayout = buildTaskRowsForGame(gameKey, DESKTOP_LAYOUT);
		const compactLayout = buildTaskRowsForGame(gameKey, COMPACT_LAYOUT);

		PPGC.register({
			layoutVariants: {
				desktop: { taskRows: desktopLayout },
				compact: { taskRows: compactLayout },
			},
		});
	}
})();
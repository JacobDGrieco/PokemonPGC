services:
  app:
    build: .
    ports: ["3000:3000"]
    environment:
      NODE_ENV: production
      DATABASE_URL: "file:./data/pokemonpgc.db"
      PGC_USER_ID: "owner"
      PGC_SPRITES_BASE: "/sprites"
    volumes:
      - pgcdata:/app/data
    profiles: ["prod"]   # <-- prod profile (build once, no hot reload)

  app-dev:
    build: .
    command: bash -lc "npm install && npx prisma db push && npm run dev"
    environment:
      NODE_ENV: production
      # use absolute path inside the container
      DATABASE_URL: "file:/app/data/pokemonpgc.db"
      PGC_USER_ID: "owner"
      PGC_SPRITES_BASE: "/sprites"
    ports: ["3000:3000"]
    volumes:
      - ./:/app          # live-mount your code for hot reload
      - pgcdata:/app/data
      - /app/node_modules  # keeps containerâ€™s node_modules writable
    profiles: ["dev"]    # <-- dev profile (hot reload)
volumes:
  pgcdata:
